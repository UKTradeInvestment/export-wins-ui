var ew={components:{},pages:{},tools:{},controllers:{},application:{components:{},controllers:{}}};ew.CustomEvent=function(){function t(){this.subscribers=[]}var e=t.prototype;return e.subscribe=function(t){this.subscribers.push(t)},e.unSubscribe=function(t){for(var e=0,o=this.subscribers.length;e<o;e++)if(this.subscribers[e]===t){this.subscribers.pop(e,1);break}},e.publish=function(){for(var t=this.subscribers.length-1;0<=t;t--)try{this.subscribers[t].apply(this,arguments)}catch(t){}},t}(),ew.tools.toLocaleString=function(t,e,o){e=e||",",o=0===o?o:3;for(var n,r=(""+t).split("."),i=r[0].length,s="";o<i;)n=i-o,s=e+r[0].slice(n,i)+s,i=n;return s=r[0].slice(0,i)+s,r[0]=s,r.join(".")},ew.components.AddContributors=function(n){function o(t){return t+" is required for AddContributorsComponent"}function t(t){if(!t)throw new Error(o("opts"));if(!t.contributorsSelector)throw new Error(o("opts.contributorsSelector"));if(!t.nameInputSelector)throw new Error(o("opts.nameInputSelector"));var e=this;this.$contributors=n(t.contributorsSelector),this.contributorsSelector=t.contributorsSelector,this.nameInputSelector=t.nameInputSelector,this.shownContributors=0,this.contributorsLength=this.$contributors.length,this.$removeButton=n('<button type="button" class="btn btn-xs btn-default remove-contributor" aria-label="Remove contributor" title="Remove contributor">Remove</button>'),this.createAddButton(),this.hideContributingLines(),this.showCloseButton(),this.$addButton.on("click",n.proxy(this.addContributor,this)),this.$contributors.on("click",".remove-contributor",function(t){e.removeContributor(t,this)})}return t.prototype.focusOnFirstNameInput=function(){var t=n(this.$contributors[0]).find(this.nameInputSelector);t.val()||t.focus()},t.prototype.showCloseButton=function(){var t=n(this.contributorsSelector+":visible").last();t.is(this.$contributors[0])||t.prepend(this.$removeButton)},t.prototype.removeCloseButton=function(){this.$removeButton.remove()},t.prototype.updateCloseButton=function(){var t=this;this.removeCloseButton(),window.setTimeout(function(){t.showCloseButton()},1)},t.prototype.createAddButton=function(){this.$addButton=n('<button class="btn btn-default">Add another contributor</button>'),this.$contributors.parent().append(this.$addButton)},t.prototype.hideContributingLines=function(){var o=this;o.$contributors.each(function(t){var e=n(this);0===t?e.show():t>o.shownContributors&&0<e.find(o.nameInputSelector).val().length?(e.show(),o.shownContributors++):e.hide()})},t.prototype.addContributor=function(t){var e;t.preventDefault(),this.shownContributors<this.contributorsLength?(this.shownContributors++,(e=n(this.$contributors[this.shownContributors])).show(),e.find(this.nameInputSelector).focus(),this.updateCloseButton(),this.checkAddButtonState()):alert("Sorry, the system can't add more than 5 contributing teams. Please choose teams that contributed the most.")},t.prototype.checkAddButtonState=function(){var t=this.shownContributors===this.contributorsLength-1;this.$addButton[0].disabled=t},t.prototype.resetAll=function(){var t=this;this.$contributors.each(function(){t.resetContributor(n(this))})},t.prototype.resetContributor=function(t){t.find("input").val(""),t.find("select").each(function(){this.selectedIndex=0}),t.find(".alert-danger").remove(),t.removeClass("error")},t.prototype.removeContributor=function(t,e){var o=n(e).parent(this.contributorsSelector);o.hide(),this.resetContributor(o),this.shownContributors--,this.updateCloseButton(),this.checkAddButtonState()},t}(jQuery),ew.components.AddSelect=function(e){var o="disabled";function n(t){return t+" is required for AddSelectComponent"}function t(t){if(!t)throw new Error(n("opts"));if(!t.selector)throw new Error(n("opts.selector"));if(!t.labelText)throw new Error(n("opts.labelText"));this.selector=t.selector,this.required=!!t.required,this.labelText=t.labelText,this.buttonText=t.buttonText||"Add another",this.minVisible=0===t.minVisible?0:t.minVisible||1,this.$selects=e(this.selector),this.$groups=this.$selects.closest(".form-group"),this.$group=this.$selects.closest(".add-select-group"),this.count=this.$selects.length,this.visible=this.count,this.$addButton=e('<button class="btn btn-default">'+this.buttonText+"</button>"),this.$removeButton=e('<button class="btn btn-default remove-select">Remove</button>'),this.ensureSeqential(),this.hideOthers(),this.createLabel(),this.$addButton.appendTo(this.$group),this.updateRemoveButton(),this.checkAddButtonState(),this.$addButton.on("click",e.proxy(this.addSelect,this)),this.$groups.on("click",".remove-select",e.proxy(this.removeSelect,this))}return t.prototype.createLabel=function(){this.$groups.find("label, span").remove();var t=e('<h4 class="form-label">'+this.labelText+"</h4>");this.required&&t.prepend('<span class="required">*</span>'),this.$group.prepend(t)},t.prototype.removeSelect=function(t){t.preventDefault(),this.visible--,e(this.$groups[this.visible]).hide(),this.$selects[this.visible].selectedIndex=0,this.visible<this.count&&this.$addButton.removeClass(o),this.updateRemoveButton()},t.prototype.ensureSeqential=function(){var n=this.count-1,r=this.$selects;r.each(function(t){if(t<n){var e,o=t+1;for(e=r[o];o<=n&&e&&0===e.selectedIndex;)e=r[o],o++;0===this.selectedIndex&&0<e.selectedIndex&&(this.selectedIndex=e.selectedIndex,e.selectedIndex=0)}})},t.prototype.hideOthers=function(){for(var t=this.minVisible;t<this.count;t++)0===this.$selects[t].selectedIndex&&(e(this.$groups[t]).hide(),this.visible--)},t.prototype.checkAddButtonState=function(){this.visible===this.count&&this.$addButton.addClass(o)},t.prototype.updateRemoveButton=function(){this.visible>this.minVisible?this.$removeButton.insertAfter(this.$selects[this.visible-1]):this.$removeButton.remove()},t.prototype.addSelect=function(t){t.preventDefault(),this.visible<this.count&&(e(this.$groups[this.visible]).show(),this.visible++,this.updateRemoveButton(),this.checkAddButtonState())},t}(jQuery),ew.components.CalculateExportValue=function(r,i,s){var o=/^0+$/;function e(t){return t+" is required for CalculateExportValueComponent"}function t(t){if(!t)throw new Error(e("opts"));if(!t.values)throw new Error(e("opts.values"));if(!t.total)throw new Error(e("opts.total"));this.values=t.values,this.$total=i("#"+t.total),this.currency="Â£",this.$values=[],this.updateHtml(),this.getValueElems(),this.setupListeners(),this.updateValue()}return t.prototype.resetValues=function(){for(var t,e=0;t=this.$values[e++];)t.val(0);this.updateValue()},t.prototype.updateHtml=function(){var t="export-total-years",e="export-total-value",o=this.$total.parents(".form-group"),n=r.createElement("p");this.$total.hide(),o.find(".help-text").hide(),o.find("label").hide(),o.find(".required").hide(),n.className="export-total",n.innerHTML='Totaling over <span class="'+t+'"></span>: <span class="'+e+'"</span>',o[0].appendChild(n),this.$totalYears=o.find("."+t),this.$totalValue=o.find("."+e)},t.prototype.getValueElems=function(){for(var t,e=0;t=this.values[e++];)t="#"+t,this.$values.push(i(t))},t.prototype.setupListeners=function(){var e,o=this,t=0,n=i.proxy(this.updateValue,this);function r(t){e.on("keyup",n),t.on("focus",function(){o.handleFocus(t)}),t.on("blur",function(){o.handleBlur(t)})}for(;e=this.$values[t++];)r(e)},t.prototype.handleBlur=function(t){var e=t.val();""!==e&&!o.test(e)||t.val(0)},t.prototype.handleFocus=function(t){o.test(t.val())&&t.val("")},t.prototype.updateValue=function(){for(var t,e,o=0,n=0,r=0;t=this.$values[n++];)0<(e=parseInt(t.val(),10))&&(o+=e,r++);this.$totalYears.text(r+(1===r?" year":" years")),this.$totalValue.text(this.currency+s(o)),this.$total.val(o)},t}(document,jQuery,ew.tools.toLocaleString),ew.components.CleanPastedInput=function(){function t(t){this.$elem=t,this.elem=t[0],this.$elem.on("paste",$.proxy(this.handlePaste,this))}return t.prototype.cleanValue=function(){this.elem.value=this.elem.value.replace(/^\s+|\s+$/g,"")},t.prototype.handlePaste=function(){this.elem&&setTimeout($.proxy(this.cleanValue,this),1)},t}(),ew.components.DisableMultiSubmit=function(o){function t(t,e){if(!t)throw new Error("formId is required for DisableMultiSubmitComponent");this.$form=o("#"+t),this.savingText=e||"Saving...",this.$submitButton=this.$form.find("input[type=submit]"),this.submitInProgress=!1,this.$form.on("submit",o.proxy(this.handleSubmit,this))}return t.prototype.handleSubmit=function(t){this.submitInProgress?t.preventDefault():(this.submitInProgress=!0,this.$submitButton.attr("disabled",!0),this.$submitButton.val(this.savingText))},t}(jQuery),ew.components.ToggleContributors=function(o,e){function n(t){return t+" is required for ToggleContributorsComponent"}function t(t){if(!t)throw new Error(n("opts"));if(!t.$contributingTeamDetails)throw new Error(n("opts.$contributingTeamDetails"));if(!t.$someContributors)throw new Error(n("opts.$someContributors"));if(!t.noContributorsSelector)throw new Error(n("opts.noContributorsSelector"));this.$contributingTeamDetails=t.$contributingTeamDetails,this.$someContributors=t.$someContributors,this.noContributorsSelector=t.noContributorsSelector,this.events={showDetails:new e,hideDetails:new e},this.checkContributingDetails(),this.createListeners()}return t.prototype.toggleContributingDetails=function(t){this.$someContributors[0].checked?(this.$contributingTeamDetails.show(),this.events.showDetails.publish()):(this.$contributingTeamDetails.hide(),this.events.hideDetails.publish())},t.prototype.createListeners=function(){var t=o(this.noContributorsSelector),e=o.proxy(this.toggleContributingDetails,this);this.$someContributors.on("click",e),t.on("click",e)},t.prototype.checkContributingDetails=function(){this.$someContributors[0].checked||this.$contributingTeamDetails.hide()},t}(jQuery,ew.CustomEvent),ew.components.ToggleExportValue=function(e,o){function n(t){return t+" is required for ToggleExportValueComponent"}function t(t){if(!t)throw new Error(n("opts"));if(!t.fieldId)throw new Error(n("opts.fieldId"));if(!t.contentId)throw new Error(n("opts.contentId"));this.events={hide:new o},this.$content=e("#"+t.contentId),this.$field=e("#"+t.fieldId),this.$field.on("change",e.proxy(this.showContent,this)),this.showContent()}return t.prototype.showContent=function(){this.$field[0].checked?this.$content.show():(this.$content.hide(),this.events.hide.publish())},t}(jQuery,ew.CustomEvent),ew.components.UpdateSelect=function(o){function n(t){return t+" is required for UpdateSelectComponent"}function t(t){if(!t)throw new Error(n("opts"));if(!t.firstSelect)throw new Error(n("opts.firstSelect"));if(!t.secondSelect)throw new Error(n("opts.secondSelect"));var e=this;if(e.delimiter=t.delimiter||":",e.$firstSelect=o(t.firstSelect),e.$secondSelect=o(t.secondSelect),e.$secondSelectOptions=e.$secondSelect.find("option"),!e.$firstSelect.length)throw new Error("firstSelect not found");if(!e.$secondSelect.length)throw new Error("secondSelect not found");if(e.$options=e.$secondSelectOptions.clone(),!e.$options.length)throw new Error("Select contains no options");e.$firstSelect.on("change",function(){e.handleChange(this)}),e.setInitialState()}return t.prototype.setInitialState=function(){var t=this.$firstSelect.val();this.setOptions(t)},t.prototype.setOptions=function(t){t?this.updateOptions(t):this.chooseTeamMessage()},t.prototype.chooseTeamMessage=function(){var t=this.$options.clone().filter(function(){return""===this.value});t.text("Please choose a team type first"),this.$secondSelect.empty().append(t)},t.prototype.updateOptions=function(t){var e=this.$options.clone(),o=t+this.delimiter,n=o.length,r=e.filter(function(t){return""===this.value||this.value.substring(0,n)===o});this.$secondSelect.empty(),r.appendTo(this.$secondSelect)},t.prototype.handleChange=function(t){var e=t.value;this.setOptions(e),this.$secondSelect[0].selectedIndex=0},t}(jQuery),ew.components.WordCounter=function(e){var n="text-danger";function o(t){return t+"is required for WordCounterComponent"}function t(t){if(!t)throw new Error(o("opts"));if(!t.limit)throw new Error(o("opts.limit"));if(!t.id)throw new Error(o("opts.id"));this.limit=t.limit,this.$input=e("#"+t.id),this.createCounter(),this.$input.on("keyup",e.proxy(this.upateCount,this))}return t.prototype.createCounter=function(){this.$counter=e('<span class="word-counter">0 words</span>'),this.$counter.insertAfter(this.$input),this.upateCount()},t.prototype.getWordCount=function(t){return t.replace(/\s+$/,"").split(" ").length},t.prototype.upateCount=function(){var t=this.$input.val(),e=t?this.getWordCount(t):0,o=1===e?"word":"words";this.$counter.text(e+" "+o),e>this.limit?this.$counter.addClass(n):this.$counter.removeClass(n)},t}(jQuery),ew.controllers.Contributors=function(){function o(t){return t+" is a required parameter for ContributorsController"}return function(t,e){if(!t)throw new Error(o("toggleContributors"));if(!e)throw new Error(o("addContributors"));t.events.showDetails.subscribe(function(){e.focusOnFirstNameInput(),e.updateCloseButton()}),t.events.hideDetails.subscribe(function(){e.resetAll()})}}(),ew.controllers.ExportValue=function(){function o(t){return t+" is required for ExportValueController"}function t(t,e){if(!t.exportValue)throw new Error(o("fields.exportValue"));if(!t.nonExportValue)throw new Error(o("fields.nonExportValue"));if(!t.odiValue)throw new Error(o("fields.odiValue"));this.setupFields(t)}return t.prototype.setupFields=function(t){t.exportValue.toggler.events.hide.subscribe(function(){t.exportValue.calculator.resetValues()}),t.nonExportValue.toggler.events.hide.subscribe(function(){t.nonExportValue.calculator.resetValues()}),t.odiValue.toggler.events.hide.subscribe(function(){t.odiValue.calculator.resetValues()})},t}(),ew.pages.confirmationForm=function(t,e,o){var n,r,i,s,u,l,a,c;function p(){u.filter(":checked").val()===c?(l.show(),a.focus()):(l.hide(),a.val(""))}n=e,r=$("#confirm-false-info"),(i=$("form input[name="+n+"]"))[1].checked||r.hide(),i.on("change",function(t){i[0].checked?r.hide():r.show()}),s=o,u=$("form input[name="+s.inputName+"]"),l=$("."+s.otherWrapper),a=$("form input[name="+s.otherInputName+"]"),c=u.last().val(),u.change(p),p(),ew.application.components.stopConfirmationFormSubmit=new ew.components.DisableMultiSubmit(t)},ew.pages.officerForm=function(){function l(t,e,o){var n;e.leadOfficerTeam=new ew.components.UpdateSelect({firstSelect:"#id_team_type",secondSelect:"#id_hq_team"}),e.contributingOfficerTeams=(n=[],$(".contributing-officer-team-group").each(function(){var t=$(this);n.push(new ew.components.UpdateSelect({firstSelect:t.find(".contributing-team-type select")[0],secondSelect:t.find(".contributing-team select")[0]}))}),n),e.toggleContributors=new ew.components.ToggleContributors({$contributingTeamDetails:$("#contributing-teams-details"),$someContributors:$("#some-contributors"),noContributorsSelector:"#no-contributors"}),e.addContributors=new ew.components.AddContributors({contributorsSelector:".contributing-officer-group",nameInputSelector:".contributing-officer-name input"}),e.stopWinFormSubmit=new ew.components.DisableMultiSubmit(t.formId),o.contributors=new ew.controllers.Contributors(e.toggleContributors,e.addContributors),e.supportSelects=new ew.components.AddSelect(t.supportGroup),e.programmeSelects=new ew.components.AddSelect(t.programmeGroup),e.contactEmailCleaner=new ew.components.CleanPastedInput($("#id_customer_email_address")),e.leadOfficerEmailCleaner=new ew.components.CleanPastedInput($("#id_lead_officer_email_address")),e.secondaryEmailCleaner=new ew.components.CleanPastedInput($("#id_other_official_email_address"))}function a(t){return t+" is required for officerFormPage"}return function(t){if(!t)throw new Error(a("opts"));if(void 0===t.isComplete)throw new Error(a("opts.isComplete"));if(!t.formId)throw new Error(a("opts.formId"));if(!t.supportGroup)throw new Error(a("opts.supportGroup"));if(!t.programmeGroup)throw new Error(a("opts.programmeGroup"));if(!t.isComplete){if(!t.descriptionId)throw new Error(a("opts.descriptionId"));if(!t.exportType)throw new Error(a("opts.exportType"));if(!t.exportType.exportValue)throw new Error(a("opts.exportType.exportValue"));if(!t.exportType.nonExportValue)throw new Error(a("opts.exportType.nonExportValue"));if(!t.exportType.odiValue)throw new Error(a("opts.exportType.odiValue"));if(!t.exportContentId)throw new Error(a("opts.exportContentId"));if(!t.nonExportContentId)throw new Error(a("opts.nonExportContentId"));if(!t.exportValues||!t.exportValues.length)throw new Error(a("opts.exportValue"));if(!t.exportTotal)throw new Error(a("opts.exportTotal"));if(!t.nonExportValues||!t.nonExportValues.length)throw new Error(a("opts.nonExportValues"));if(!t.nonExportTotal)throw new Error(a("opts.nonExportTotal"));t.country&&(o=t.country).value!==o.remove&&$("#"+o.id+" option").each(function(t,e){if(e.value===o.remove)return $(e).remove(),!1})}var o,e,n,r,i=ew.application,s=i.components,u=i.controllers;l(t,s,u),t.isComplete||(e=t,r=u,(n=s).descriptionWordCounter=new ew.components.WordCounter({id:e.descriptionId,limit:50}),n.exportValue=new ew.components.ToggleExportValue({fieldId:e.exportType.exportValue,contentId:e.exportContentId}),n.nonExportValue=new ew.components.ToggleExportValue({fieldId:e.exportType.nonExportValue,contentId:e.nonExportContentId}),n.odiValue=new ew.components.ToggleExportValue({fieldId:e.exportType.odiValue,contentId:e.odiContentId}),n.calculateExportValue=new ew.components.CalculateExportValue({values:e.exportValues,total:e.exportTotal}),n.calculateNonExportValue=new ew.components.CalculateExportValue({values:e.nonExportValues,total:e.nonExportTotal}),n.calculateOdiValue=new ew.components.CalculateExportValue({values:e.odiValues,total:e.odiTotal}),r.exportValue=new ew.controllers.ExportValue({exportValue:{toggler:n.exportValue,calculator:n.calculateExportValue},nonExportValue:{toggler:n.nonExportValue,calculator:n.calculateNonExportValue},odiValue:{toggler:n.odiValue,calculator:n.calculateOdiValue}}))}}(),ew.pages.winComplete=function(t){ew.application.components.stopWinCompleteForm=new ew.components.DisableMultiSubmit(t,"Sending win...")};
//# sourceMappingURL=main_2018-04-29.min.js.map